<div class="well">
  <h1><%= @auction.title %></h1>
  <p><%= @auction.details %></p>
  <p>Reserve Price: <%= number_to_currency(@auction.reserve_price) %></p>
  <p>End Date: <%= @auction.end_date %></p>
  <p><span class="label <%= label_class(@auction.aasm_state) %>"><%= @auction.aasm_state.capitalize %></span></p>
  <%# may_publish? is a method generated by AASM that will tell you if you're able to publish a
    campaign based on the rules defined in the Campaign AASM %>
  <% if @auction.may_publish? %>
    <%= link_to "Publish", auction_publishings_path(@auction),
              method: :post,
              data:   {confirm: "Are you sure you want to publish?"},
              class:  "btn btn-primary" %>
  <% end %>

  <% if user_signed_in? && @auction.user == current_user %>
    <%= link_to "Edit", edit_auction_path(@auction), class: "btn btn-info btn-sm edit-right"%>
    <%= link_to "Delete", auction_path(@auction), method: :delete,
            class: "btn btn-danger btn-sm delete-right", data: {confirm: "Are you use you want to delete this auction?"} %>
  <% end %>


  <br>
  <br>
    <div class="well">
      <p style="font-weight: 900">Current Price:
        <% if @auction.reserve_price.to_s < @auction.bids.maximum("bid_price").to_s %>
          <%= number_to_currency(@auction.bids.maximum("bid_price").to_s) %></p>
        <% else %>
          <%= number_to_currency(@auction.reserve_price.to_s) %>
        <% end %>
      <% if @auction.bids.maximum("bid_price") != nil %>
      <br>
      <br>
      <br>
      <% if (@auction.bids.maximum("bid_price") <= @auction.reserve_price ) %>
        <p style="color: red">Reserve Price Not Met</p>
      <% else %>
        <p style="color: green; font-weight: 700">Sold!! to <%= @auction.bids.last.user.first_name.capitalize %> <%= @auction.bids.last.user.last_name.capitalize %></p>
        <% @auction.reserve_met %>
        <% @auction.save %>
      <% end %>
    </div>
  <% end %>
</div>

<hr style="clear: both">


<div class="clearfix"></div>

<% if @auction.published? %>
  <h2>Make a Bid</h2>
  <%= simple_form_for [@auction, @bid] do |f| %>
    <% if current_user == @auction.user%>
      <h3 style="font-weight: 800; color: red;">You are not possible to bid your own product</h3>
    <% elsif !user_signed_in?%>
      <h3 style="font-weight: 800; color: red;">You are not possible to bid. You need to Log In first</h3>
    <% else %>
      <%= f.input :bid_price, as: :string %>
      <%= f.submit "Bid", class: "btn btn-primary" %>
    <% end %>
  <% end %>
  <hr>
  <% if user_signed_in? && current_user != @auction.user %>
    <h2>Previous Bids</h2>
    <br>
    <% @auction.bids.order('created_at DESC').each do |bid| %>
      <div class="well">
        <%= number_to_currency(bid.bid_price) %> at <%= bid.created_at.strftime("%b %d. %Y") %> by <%= bid.user.first_name.capitalize %> <%=   bid.user.last_name.capitalize %>
      </div>
    <% end %>
  <% end %>
<% end %>
