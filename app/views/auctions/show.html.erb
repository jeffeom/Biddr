<div class="well">
  <h1><%= @auction.title %></h1>
  <p><%= @auction.details %></p>
  <p>Reserve Price: <%= number_to_currency(@auction.reserve_price) %></p>
  <p>End Date: <%= @auction.end_date %></p>
  <p><span class="label <%= label_class(@auction.aasm_state) %>"><%= @auction.aasm_state.capitalize %></span></p>
  <%# may_publish? is a method generated by AASM that will tell you if you're able to publish a
    campaign based on the rules defined in the Campaign AASM %>
  <% if @auction.may_publish? %>
    <%= link_to "Publish", auction_publishings_path(@auction),
              method: :post,
              data:   {confirm: "Are you sure you want to publish?"},
              class:  "btn btn-primary" %>
  <% end %>
  <%= link_to "Edit", edit_auction_path(@auction), class: "btn btn-info" %>
  <%= link_to "Delete", @auction, class: "btn btn-danger" %>
                <%# may_publish? is a method generated by AASM that will tell you if you're able
                to publish a campaign based on the rules defined in the Campaign AASM %>


  <br>
  <br>
  <% if @auction.bids.maximum("bid_price") != nil %>
    <div class="well">
      <p style="font-weight: 900">Current Price: <%= number_to_currency(@auction.bids.maximum("bid_price").to_s) %></p>
      <br>
      <br>
      <br>
      <% if (@auction.bids.maximum("bid_price") < @auction.reserve_price ) %>
        <p style="color: red">Reserve Price Not Met</p>
      <% else %>
        <p style="color: green">Sold!!</p>
        <% @auction.reserve_met %>
        <% @auction.save %>
      <% end %>
    </div>
  <% end %>
</div>

<hr style="clear: both">


<div class="clearfix"></div>

<% if @auction.published? %>
  <h2>Make a Bid</h2>
  <%= simple_form_for [@auction, @bid] do |f| %>
    <%= f.input :bid_price, as: :string %>
    <%= f.submit "Bid", class: "btn btn-primary" %>
  <% end %>
  <hr>
  <h2>Previous Bids</h2>
  <br>
  <% @auction.bids.order('created_at DESC').each do |bid| %>
    <div class="well">
      <%= number_to_currency(bid.bid_price) %> at <%= bid.created_at.strftime("%b %d. %Y") %>
    </div>
  <% end %>
<% end %>
